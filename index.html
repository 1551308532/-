<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>招聘/转正台账统计（白版）</title>
  <style>
    :root {
      --bg: #f4f5fb;
      --panel: #ffffff;
      --border: #e2e8f0;
      --text: #0f172a;
      --muted: #64748b;
      --radius: 14px;
      --accent: #2563eb;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      background: var(--bg);
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: var(--text);
      padding: 18px 18px 60px;
    }
    h1 { font-size: 1.05rem; margin: 0 0 14px; }
    .layout {
      display: grid;
      grid-template-columns: 1.08fr 0.92fr;
      gap: 16px;
      align-items: flex-start;
    }
    .panel {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: 0 10px 25px rgba(15,23,42,.04);
    }
    .panel-header {
      padding: 12px 14px 4px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .panel-title small { display: block; color: var(--muted); font-size: .62rem; }
    .tabs { display: flex; gap: 6px; padding: 0 14px 10px; }
    .tab { background: #eff6ff; border: 1px solid transparent; border-radius: 999px; padding: 4px 12px 5px; font-size: .68rem; color: #1d4ed8; cursor: pointer; }
    .tab.active { background: #1d4ed8; color: #fff; }
    .table-wrap { max-height: 420px; overflow: auto; border-top: 1px solid #eef2f8; }
    table { width: 100%; border-collapse: collapse; font-size: .7rem; }
    th, td { text-align: left; padding: 6px 12px; border-bottom: 1px solid #edf2f7; white-space: nowrap; }
    th { color: var(--muted); font-weight: 500; background: #f8fafc; }
    tbody tr:hover { background: #eff6ff; }
    .hidden { display: none; }
    .right-wrap { padding: 10px 14px 14px; }
    .metric-picker {
      appearance: none;
      -webkit-appearance: none;
      background: #ffffff url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 20 20" fill="none" stroke="%2364748b" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 8 10 12 14 8"/></svg>') no-repeat right .4rem center;
      border: 1px solid #d1d9e6;
      border-radius: 999px;
      padding: 4px 26px 4px 10px;
      font-size: .65rem;
      color: #0f172a;
      cursor: pointer;
    }
    canvas { width: 100%; background: #ffffff; border: 1px solid #e2e8f0; border-radius: 12px; }
    .chart-block { margin-top: 10px; }
    .chart-title { font-size: .65rem; color: var(--muted); margin-bottom: 4px; display: flex; justify-content: space-between; }
    @media (max-width: 1080px) { .layout { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <h1>招聘/转正台账统计（周度 + 考勤月 25→次月24）</h1>
  <div class="layout">
    <!-- 左侧表格 -->
    <div class="panel">
      <div class="panel-header">
        <div class="panel-title">
          <strong id="table-title">周度统计</strong>
          <small id="table-sub">按周一→周日聚合，共 25 周</small>
        </div>
      </div>
      <div class="tabs">
        <div class="tab active" data-tab="weekly">按周</div>
        <div class="tab" data-tab="month">按考勤月</div>
      </div>
      <div class="table-wrap" id="table-weekly-wrap">
        <table id="weekly-table">
          <thead>
            <tr>
              <th>周起始</th>
              <th>周结束</th>
              <th>推荐量</th>
              <th>筛选通过量</th>
              <th>到面量</th>
              <th>Offer结果数</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
      <div class="table-wrap hidden" id="table-month-wrap">
        <table id="month-table">
          <thead>
            <tr>
              <th>考勤月</th>
              <th>区间</th>
              <th>推荐量</th>
              <th>筛选通过量</th>
              <th>到面量</th>
              <th>Offer结果数</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <!-- 右侧图表 -->
    <div class="panel">
      <div class="panel-header">
        <div class="panel-title">
          <strong>可视化</strong>
          <small>切换指标时两张图同时刷新</small>
        </div>
        <select id="metric-picker" class="metric-picker">
          <option value="tuijian">推荐量</option>
          <option value="shai">筛选通过量</option>
          <option value="daomian">到面量</option>
          <option value="offer">Offer结果数</option>
        </select>
      </div>
      <div class="right-wrap">
        <div class="chart-block">
          <div class="chart-title"><span id="weekly-chart-title">周度 - 推荐量</span><span style="font-size:.6rem;">单位：条</span></div>
          <canvas id="weekly-canvas" height="180"></canvas>
        </div>
        <div class="chart-block">
          <div class="chart-title"><span id="month-chart-title">考勤月 - 推荐量</span><span style="font-size:.6rem;">单位：条</span></div>
          <canvas id="month-canvas" height="140"></canvas>
        </div>
      </div>
    </div>
  </div>

  <script>
    // 数据
    const weeklyData = [
      {start: '2025-05-12', end: '2025-05-18', tui: 3, shai: 0, dm: 0, offer: 0},
      {start: '2025-05-19', end: '2025-05-25', tui: 26, shai: 3, dm: 3, offer: 0},
      {start: '2025-05-26', end: '2025-06-01', tui: 30, shai: 9, dm: 8, offer: 0},
      {start: '2025-06-02', end: '2025-06-08', tui: 13, shai: 2, dm: 4, offer: 0},
      {start: '2025-06-09', end: '2025-06-15', tui: 27, shai: 3, dm: 2, offer: 1},
      {start: '2025-06-16', end: '2025-06-22', tui: 16, shai: 5, dm: 5, offer: 0},
      {start: '2025-06-23', end: '2025-06-29', tui: 23, shai: 5, dm: 3, offer: 0},
      {start: '2025-06-30', end: '2025-07-06', tui: 24, shai: 7, dm: 6, offer: 0},
      {start: '2025-07-07', end: '2025-07-13', tui: 25, shai: 7, dm: 5, offer: 0},
      {start: '2025-07-14', end: '2025-07-20', tui: 25, shai: 8, dm: 4, offer: 0},
      {start: '2025-07-21', end: '2025-07-27', tui: 21, shai: 4, dm: 4, offer: 0},
      {start: '2025-07-28', end: '2025-08-03', tui: 23, shai: 5, dm: 4, offer: 0},
      {start: '2025-08-04', end: '2025-08-10', tui: 25, shai: 4, dm: 3, offer: 1},
      {start: '2025-08-11', end: '2025-08-17', tui: 27, shai: 4, dm: 4, offer: 0},
      {start: '2025-08-18', end: '2025-08-24', tui: 21, shai: 4, dm: 4, offer: 0},
      {start: '2025-08-25', end: '2025-08-31', tui: 28, shai: 7, dm: 6, offer: 0},
      {start: '2025-09-01', end: '2025-09-07', tui: 27, shai: 2, dm: 1, offer: 0},
      {start: '2025-09-08', end: '2025-09-14', tui: 23, shai: 2, dm: 1, offer: 0},
      {start: '2025-09-15', end: '2025-09-21', tui: 20, shai: 3, dm: 2, offer: 1},
      {start: '2025-09-22', end: '2025-09-28', tui: 15, shai: 4, dm: 2, offer: 0},
      {start: '2025-09-29', end: '2025-10-05', tui: 10, shai: 2, dm: 1, offer: 1},
      {start: '2025-10-06', end: '2025-10-12', tui: 17, shai: 5, dm: 4, offer: 1},
      {start: '2025-10-13', end: '2025-10-19', tui: 26, shai: 7, dm: 6, offer: 1},
      {start: '2025-10-20', end: '2025-10-26', tui: 25, shai: 4, dm: 3, offer: 0},
      {start: '2025-10-27', end: '2025-11-02', tui: 28, shai: 10, dm: 4, offer: 0},
    ];
    const monthData = [
      {month: '2025-05', range: '2025-04-25 ～ 2025-05-24', tui: 29, shai: 3, dm: 3, offer: 0},
      {month: '2025-06', range: '2025-05-25 ～ 2025-06-24', tui: 91, shai: 19, dm: 19, offer: 1},
      {month: '2025-07', range: '2025-06-25 ～ 2025-07-24', tui: 105, shai: 30, dm: 21, offer: 0},
      {month: '2025-08', range: '2025-07-25 ～ 2025-08-24', tui: 119, shai: 29, dm: 24, offer: 1},
      {month: '2025-09', range: '2025-08-25 ～ 2025-09-24', tui: 114, shai: 13, dm: 6, offer: 2},
      {month: '2025-10', range: '2025-09-25 ～ 2025-10-24', tui: 87, shai: 19, dm: 14, offer: 3},
      {month: '2025-11', range: '2025-10-25 ～ 2025-11-24（仅到11-01）', tui: 34, shai: 12, dm: 5, offer: 0},
    ];

    // 填表
    const weeklyTbody = document.querySelector('#weekly-table tbody');
    weeklyData.forEach(r => {
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${r.start}</td><td>${r.end}</td><td>${r.tui}</td><td>${r.shai}</td><td>${r.dm}</td><td>${r.offer}</td>`;
      weeklyTbody.appendChild(tr);
    });
    const monthTbody = document.querySelector('#month-table tbody');
    monthData.forEach(r => {
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${r.month}</td><td>${r.range}</td><td>${r.tui}</td><td>${r.shai}</td><td>${r.dm}</td><td>${r.offer}</td>`;
      monthTbody.appendChild(tr);
    });

    // tabs 切换
    const tabs = document.querySelectorAll('.tab');
    const weeklyWrap = document.getElementById('table-weekly-wrap');
    const monthWrap = document.getElementById('table-month-wrap');
    const tableTitle = document.getElementById('table-title');
    const tableSub = document.getElementById('table-sub');
    tabs.forEach(t => {
      t.addEventListener('click', () => {
        tabs.forEach(x => x.classList.remove('active'));
        t.classList.add('active');
        if (t.dataset.tab === 'weekly') {
          weeklyWrap.classList.remove('hidden');
          monthWrap.classList.add('hidden');
          tableTitle.textContent = '周度统计';
          tableSub.textContent = '按周一→周日聚合，共 25 周';
        } else {
          weeklyWrap.classList.add('hidden');
          monthWrap.classList.remove('hidden');
          tableTitle.textContent = '按考勤月统计（25→次月24）';
          tableSub.textContent = '2025-05 ～ 2025-11（11 月数据不完整）';
        }
      });
    });

    // ========= 简易画图 =========
    function drawLineChart(canvas, labels, values, color) {
      const ctx = canvas.getContext('2d');
      const w = canvas.width;
      const h = canvas.height;
      ctx.clearRect(0,0,w,h);
      const padding = 28;
      const maxVal = Math.max(...values, 1);
      const xStep = (w - padding*2) / Math.max(values.length - 1, 1);
      const baseY = h - padding;
      ctx.strokeStyle = '#e2e8f0';
      ctx.lineWidth = 1;
      for (let i=0;i<4;i++) {
        const y = padding + (baseY - padding) * (i/3);
        ctx.beginPath();
        ctx.moveTo(padding, y);
        ctx.lineTo(w - padding, y);
        ctx.stroke();
      }
      ctx.strokeStyle = color;
      ctx.lineWidth = 1.6;
      ctx.beginPath();
      values.forEach((v, idx) => {
        const x = padding + xStep * idx;
        const y = baseY - (baseY - padding) * (v / maxVal);
        if (idx === 0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
      });
      ctx.stroke();
      ctx.fillStyle = color;
      values.forEach((v, idx) => {
        const x = padding + xStep * idx;
        const y = baseY - (baseY - padding) * (v / maxVal);
        ctx.beginPath();
        ctx.arc(x,y,2.5,0,Math.PI*2);
        ctx.fill();
      });
      ctx.fillStyle = '#94a3b8';
      ctx.font = '10px system-ui';
      ctx.fillText(maxVal.toString(), 6, padding+3);
      ctx.fillText('0', 10, baseY);
    }

    function drawBarChart(canvas, labels, values, color) {
      const ctx = canvas.getContext('2d');
      const w = canvas.width;
      const h = canvas.height;
      ctx.clearRect(0,0,w,h);
      const padding = 28;
      const maxVal = Math.max(...values, 1);
      const gap = (w - padding*2) / values.length;
      const barW = gap * 0.6;
      ctx.strokeStyle = '#e2e8f0';
      for (let i=0;i<4;i++) {
        const y = padding + (h - padding*1.3 - padding) * (i/3);
        ctx.beginPath();
        ctx.moveTo(padding, y);
        ctx.lineTo(w - padding, y);
        ctx.stroke();
      }
      values.forEach((v,idx) => {
        const x = padding + gap*idx + (gap - barW)/2;
        const barH = (h - padding*1.4) * (v / maxVal);
        const y = h - padding - barH;
        ctx.fillStyle = color;
        ctx.fillRect(x, y, barW, barH);
        ctx.fillStyle = '#94a3b8';
        ctx.font = '9px system-ui';
        ctx.fillText(labels[idx], x, h - 8);
      });
      ctx.fillStyle = '#94a3b8';
      ctx.font = '10px system-ui';
      ctx.fillText(maxVal.toString(), 6, padding+3);
      ctx.fillText('0', 10, h - padding);
    }

    const metricPicker = document.getElementById('metric-picker');
    const weeklyCanvas = document.getElementById('weekly-canvas');
    const monthCanvas = document.getElementById('month-canvas');
    const weeklyTitle = document.getElementById('weekly-chart-title');
    const monthTitle = document.getElementById('month-chart-title');

    function refreshCharts(metricKey) {
      const map = {
        tuijian: {label: '推荐量', get: r => r.tui, color: '#2563eb'},
        shai: {label: '筛选通过量', get: r => r.shai, color: '#0f766e'},
        daomian: {label: '到面量', get: r => r.dm, color: '#f97316'},
        offer: {label: 'Offer结果数', get: r => r.offer, color: '#be123c'},
      };
      const m = map[metricKey];
      const wVals = weeklyData.map(m.get);
      const wLabels = weeklyData.map(r => r.start.slice(5));
      drawLineChart(weeklyCanvas, wLabels, wVals, m.color);
      const mVals = monthData.map(m.get);
      const mLabels = monthData.map(r => r.month.slice(5));
      drawBarChart(monthCanvas, mLabels, mVals, m.color);
      weeklyTitle.textContent = '周度 - ' + m.label;
      monthTitle.textContent = '考勤月 - ' + m.label;
    }

    // 初次渲染
    weeklyCanvas.width = weeklyCanvas.clientWidth * window.devicePixelRatio;
    weeklyCanvas.height = 180 * window.devicePixelRatio;
    monthCanvas.width = monthCanvas.clientWidth * window.devicePixelRatio;
    monthCanvas.height = 140 * window.devicePixelRatio;
    refreshCharts('tuijian');

    metricPicker.addEventListener('change', (e) => {
      refreshCharts(e.target.value);
    });

    window.addEventListener('resize', () => {
      weeklyCanvas.width = weeklyCanvas.clientWidth * window.devicePixelRatio;
      weeklyCanvas.height = 180 * window.devicePixelRatio;
      monthCanvas.width = monthCanvas.clientWidth * window.devicePixelRatio;
      monthCanvas.height = 140 * window.devicePixelRatio;
      refreshCharts(metricPicker.value);
    });
  </script>
</body>
</html>
